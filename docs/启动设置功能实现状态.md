# 启动设置功能实现状态

## 功能检查结果

### 1. ✅ 开机自启动（autoStart）
**状态：已完全实现**

**实现位置：** `src/main/services/settingsService.ts`
- `applyStartupSettings()` 方法使用 `app.setLoginItemSettings()` 设置开机自启动
- 当 `autoStart` 为 `true` 时，设置 `openAtLogin: true`
- 设置更改时会立即应用

**代码：**
```typescript
private applyStartupSettings(): void {
  if (this.settings.autoStart) {
    app.setLoginItemSettings({
      openAtLogin: true,
      openAsHidden: this.settings.minimizeToTray,
    });
  } else {
    app.setLoginItemSettings({
      openAtLogin: false,
    });
  }
}
```

---

### 2. ⚠️ 启动时最小化到托盘（minimizeToTray）
**状态：部分实现（需要补充）**

**已实现部分：**
- ✅ 设置已保存到配置文件
- ✅ 开机自启动时已应用（`openAsHidden`）
- ✅ 设置更改时会应用

**缺失部分：**
- ❌ **手动启动应用时没有应用此设置**
- `src/main/index.ts` 中启动时总是执行 `mainWindow.show()` 和 `mainWindow.focus()`
- 需要根据 `minimizeToTray` 设置决定是否显示窗口

**需要修复：**
```typescript
// 当前代码（index.ts）
mainWindow.show();
mainWindow.focus();

// 应该改为
const { default: settingsService } = await import('./services/settingsService');
const minimizeToTray = settingsService.getSetting('minimizeToTray');
if (!minimizeToTray) {
  mainWindow.show();
  mainWindow.focus();
} else {
  mainWindow.hide(); // 最小化到托盘
}
```

---

### 3. ⚠️ 快速启动（fastStart）
**状态：部分实现（逻辑不完整）**

**已实现部分：**
- ✅ 代码中有缓存加载逻辑（`appService.indexApps()` 优先从缓存加载）
- ✅ 书签服务有缓存逻辑（`loadBookmarks()` 优先从缓存加载）

**缺失部分：**
- ❌ **没有真正根据 `fastStart` 设置来决定行为**
- 当前逻辑：只要缓存存在就使用缓存，不存在就全量扫描
- 期望逻辑：
  - `fastStart = true`：优先使用缓存，如果缓存有效就跳过索引
  - `fastStart = false`：每次启动都执行全量索引（忽略缓存）

**当前代码问题：**
- `index.ts` 中检查缓存存在就快速加载，不存在就全量索引
- 但没有检查 `fastStart` 设置
- 如果用户希望每次启动都刷新索引（`fastStart = false`），当前无法实现

**需要修复：**
```typescript
// 当前代码（index.ts）
if (!apps || apps.length === 0) {
  // 首次启动，全量索引
} else {
  // 有缓存，快速加载
}

// 应该改为
const { default: settingsService } = await import('./services/settingsService');
const fastStart = settingsService.getSetting('fastStart');
if (!fastStart || !apps || apps.length === 0) {
  // fastStart = false 或首次启动，执行全量索引
  indexService.forceReIndex();
} else {
  // fastStart = true 且有缓存，快速加载
  appService.indexApps();
  bookmarkService.loadBookmarks();
}
```

---

## 修复建议

### 优先级：高 ⭐⭐⭐

1. **minimizeToTray** - 修复启动时窗口显示逻辑
   - 影响：用户体验，设置无效会让用户困惑
   - 难度：简单

2. **fastStart** - 完善快速启动逻辑
   - 影响：功能完整性，用户无法控制索引行为
   - 难度：中等

---

## 修复完成 ✅

### 1. minimizeToTray - 已修复
- ✅ 启动时会根据设置决定是否显示窗口
- ✅ `minimizeToTray = true` 时，窗口会自动隐藏到托盘

### 2. fastStart - 已修复
- ✅ 会根据 `fastStart` 设置决定索引行为
- ✅ `fastStart = true`：优先使用缓存，跳过全量索引
- ✅ `fastStart = false`：每次启动都执行全量索引（忽略缓存）

## 总结

| 功能 | 设置保存 | 设置应用 | 功能实现 | 状态 |
|------|---------|---------|---------|------|
| autoStart | ✅ | ✅ | ✅ | ✅ 完全实现 |
| minimizeToTray | ✅ | ✅ | ✅ | ✅ 已修复，完全实现 |
| fastStart | ✅ | ✅ | ✅ | ✅ 已修复，完全实现 |

