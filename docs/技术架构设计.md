# 技术架构设计

## 一、总体架构

### 架构图

```
┌─────────────────────────────────────────────────────────┐
│                    渲染进程（React）                       │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐      │
│  │   主窗口     │  │   设置窗口   │  │   插件管理   │      │
│  │  (搜索界面)  │  │             │  │             │      │
│  └─────────────┘  └─────────────┘  └─────────────┘      │
└─────────────────────────────────────────────────────────┘
                        ↕ IPC
┌─────────────────────────────────────────────────────────┐
│                    主进程（Electron）                      │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐      │
│  │  文件索引    │  │  应用管理    │  │  命令执行    │      │
│  └─────────────┘  └─────────────┘  └─────────────┘      │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐      │
│  │  剪贴板管理  │  │  配置管理    │  │  插件系统    │      │
│  └─────────────┘  └─────────────┘  └─────────────┘      │
└─────────────────────────────────────────────────────────┘
                        ↕ 读写
┌─────────────────────────────────────────────────────────┐
│                      数据存储层                          │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐      │
│  │  SQLite     │  │  配置文件    │  │  索引缓存    │      │
│  └─────────────┘  └─────────────┘  └─────────────┘      │
└─────────────────────────────────────────────────────────┘
```

## 二、技术栈选择

### 前端技术栈
- **框架**: React 18+
- **语言**: TypeScript 5+
- **状态管理**: Zustand (轻量级，适合 Electron)
- **UI 框架**: Tailwind CSS + Headless UI
- **动画**: Framer Motion
- **图标**: Lucide React
- **搜索**: Fuse.js（模糊搜索库）

### 构建工具
- **构建工具**: Vite 5+
- **打包工具**: electron-builder
- **代码规范**: ESLint + Prettier
- **类型检查**: TypeScript

### 后端技术栈
- **运行时**: Electron 28+
- **数据库**: SQLite 3
- **文件监控**: chokidar
- **跨平台兼容**: platform-specific code

## 三、目录结构设计

```
electron-quick/
├── src/
│   ├── main/                      # 主进程
│   │   ├── index.ts              # 主进程入口
│   │   ├── windows/               # 窗口管理
│   │   │   ├── mainWindow.ts     # 主窗口
│   │   │   ├── settingsWindow.ts # 设置窗口
│   │   │   └── pluginWindow.ts   # 插件管理窗口
│   │   ├── handlers/              # IPC 处理器
│   │   │   ├── fileHandler.ts    # 文件操作
│   │   │   ├── appHandler.ts     # 应用管理
│   │   │   ├── searchHandler.ts  # 搜索处理
│   │   │   └── commandHandler.ts # 命令执行
│   │   ├── services/              # 服务层
│   │   │   ├── indexService.ts   # 索引服务
│   │   │   ├── appService.ts      # 应用服务
│   │   │   ├── clipboardService.ts # 剪贴板服务
│   │   │   └── pluginService.ts   # 插件服务
│   │   └── database/              # 数据库
│   │       ├── db.ts             # 数据库连接
│   │       └── migrations/        # 数据库迁移
│   ├── renderer/                  # 渲染进程
│   │   ├── App.tsx               # 主组件
│   │   ├── components/            # 组件
│   │   │   ├── SearchBar.tsx     # 搜索框
│   │   │   ├── ResultList.tsx    # 结果列表
│   │   │   ├── ResultItem.tsx    # 结果项
│   │   │   ├── CommandPrompt.tsx # 命令提示
│   │   │   └── Settings/         # 设置组件
│   │   ├── hooks/                 # 自定义 Hooks
│   │   │   ├── useSearch.ts     # 搜索 Hook
│   │   │   ├── useIPC.ts         # IPC Hook
│   │   │   └── useKeyboard.ts    # 键盘 Hook
│   │   ├── stores/                # 状态管理
│   │   │   ├── searchStore.ts    # 搜索状态
│   │   │   ├── configStore.ts    # 配置状态
│   │   │   └── historyStore.ts   # 历史状态
│   │   └── utils/                 # 工具函数
│   │       ├── search.ts         # 搜索算法
│   │       ├── formatters.ts     # 格式化
│   │       └── constants.ts      # 常量
│   ├── shared/                    # 共享代码
│   │   ├── types/                 # 类型定义
│   │   │   ├── window.ts         # 窗口类型
│   │   │   ├── search.ts         # 搜索类型
│   │   │   └── plugin.ts         # 插件类型
│   │   └── constants/             # 共享常量
│   │       ├── shortcuts.ts      # 快捷键定义
│   │       └── config.ts         # 配置常量
│   └── preload/                   # 预加载脚本
│       ├── index.ts              # 预加载入口
│       └── exposeApi.ts          # API 暴露
├── docs/                          # 文档
│   ├── 功能清单.md
│   ├── 技术架构设计.md
│   ├── 开发计划.md
│   └── API文档.md
├── scripts/                       # 脚本
│   ├── build.js                  # 构建脚本
│   └── setup.js                  # 初始化脚本
├── public/                        # 静态资源
├── electron-builder.yml           # 打包配置
├── vite.config.ts                 # Vite 配置
├── tsconfig.json                  # TypeScript 配置
└── package.json                   # 项目配置
```

## 四、核心模块设计

### 1. 搜索模块

```typescript
// 搜索数据结构
interface SearchResult {
  id: string;
  type: 'app' | 'file' | 'command' | 'web' | 'history';
  title: string;
  description: string;
  icon?: string;
  action: string; // 执行动作
  score: number;  // 匹配分数
}

// 搜索接口
interface SearchService {
  search(query: string): Promise<SearchResult[]>;
  searchApps(query: string): Promise<SearchResult[]>;
  searchFiles(query: string): Promise<SearchResult[]>;
  searchHistory(query: string): Promise<SearchResult[]>;
}
```

### 2. 应用管理模块

```typescript
interface AppInfo {
  id: string;
  name: string;
  path: string;
  icon?: string;
  description?: string;
  category?: string;
  launchCount: number;
  lastUsed: Date;
}

interface AppService {
  getAllApps(): Promise<AppInfo[]>;
  launchApp(appId: string): Promise<void>;
  indexApps(): Promise<void>;
}
```

### 3. 文件索引模块

```typescript
interface FileIndex {
  id: string;
  path: string;
  name: string;
  type: string;
  size: number;
  modified: Date;
  content?: string; // 可选：全文索引
}

interface IndexService {
  indexFiles(): Promise<void>;
  searchFiles(query: string): Promise<FileIndex[]>;
  updateIndex(): Promise<void>;
}
```

### 4. IPC 通信设计

```typescript
// 主进程到渲染进程
interface MainToRenderer {
  'search-results': SearchResult[];
  'index-progress': { current: number; total: number };
}

// 渲染进程到主进程
interface RendererToMain {
  'search-query': string;
  'launch-app': string;
  'execute-command': string;
  'open-file': string;
}
```

## 五、数据存储设计

### SQLite 数据库表结构

```sql
-- 应用表
CREATE TABLE apps (
  id TEXT PRIMARY KEY,
  name TEXT NOT NULL,
  path TEXT NOT NULL,
  icon TEXT,
  launch_count INTEGER DEFAULT 0,
  last_used TEXT,
  category TEXT
);

-- 文件索引表
CREATE TABLE files (
  id TEXT PRIMARY KEY,
  path TEXT NOT NULL,
  name TEXT NOT NULL,
  type TEXT,
  size INTEGER,
  modified TEXT,
  indexed_at TEXT
);

-- 历史记录表
CREATE TABLE history (
  id TEXT PRIMARY KEY,
  type TEXT NOT NULL,
  query TEXT NOT NULL,
  result_id TEXT,
  executed_at TEXT,
  executed_count INTEGER DEFAULT 1
);

-- 快捷方式表
CREATE TABLE shortcuts (
  id TEXT PRIMARY KEY,
  command TEXT NOT NULL,
  description TEXT,
  category TEXT
);
```

## 六、性能优化策略

### 1. 索引优化
- 后台增量索引更新
- 延迟加载应用列表
- 缓存常用查询结果
- 使用 Web Worker 处理大文件索引

### 2. UI 优化
- 虚拟滚动（大列表）
- 防抖搜索输入
- 懒加载图标
- 使用 CSS 动画替代 JavaScript

### 3. 内存优化
- 及时释放不需要的资源
- 限制历史记录数量
- 压缩索引数据
- 定期清理缓存

## 七、跨平台兼容性

### 平台特定代码

```typescript
// platform.ts
export const platform = process.platform;
export const isMac = platform === 'darwin';
export const isWindows = platform === 'win32';
export const isLinux = platform === 'linux';

// 平台特定实现
export function getAppsByPlatform(): AppInfo[] {
  if (isMac) return getMacApps();
  if (isWindows) return getWindowsApps();
  if (isLinux) return getLinuxApps();
}
```

### 快捷键差异化
- **macOS**: Cmd 键
- **Windows/Linux**: Ctrl 键
- 支持全局快捷键注册

## 八、安全性考虑

### 1. 沙箱安全
- 启用 Electron 沙箱模式
- 限制预加载脚本权限
- Content Security Policy

### 2. 用户数据
- 本地数据加密存储
- 敏感信息不记录历史
- 可选：云端同步加密

### 3. 插件安全
- 插件沙箱隔离
- 权限系统
- 代码签名验证

## 九、用户体验设计

### UI 设计原则
- **简洁**: 界面简洁，操作直观
- **快速**: 响应迅速，无卡顿
- **一致**: 跨平台体验一致
- **优雅**: 流畅动画，现代设计

### 交互设计
- 键盘导航（上下箭头、Tab）
- 快捷键支持
- 自动聚焦搜索框
- 智能输入建议

### 可访问性
- 屏幕阅读器支持
- 高对比度模式
- 键盘快捷键
- 多语言支持

