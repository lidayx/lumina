# 翻译和变量名生成功能设计

## 一、功能概述

在现有工具服务基础上，新增两个实用功能：
1. **翻译功能** - 支持多语言翻译（中英文互译为主，可扩展其他语言）
2. **变量名生成** - 根据描述文本自动生成符合规范的变量名（支持多种命名风格）

## 二、功能设计

### 1. 翻译功能

#### 1.1 触发模式

支持以下触发模式：

**基础翻译（自动检测语言）**
- `translate <文本>` 或 `翻译 <文本>`
- `<文本> translate` 或 `<文本> 翻译`

**指定目标语言翻译**
- `translate <文本> to <目标语言>` 或 `翻译 <文本> 到 <目标语言>`
- `<文本> to <目标语言>` 或 `<文本> 到 <目标语言>`
- `translate <文本> from <源语言> to <目标语言>`

**快捷翻译**
- `en <中文文本>` - 翻译为英文
- `zh <英文文本>` - 翻译为中文
- `cn <英文文本>` - 翻译为中文（别名）

#### 1.2 支持的语言

**主要支持（优先实现）**
- 中文（zh / zh-CN / 中文）
- 英文（en / en-US / 英文 / English）

**可扩展语言（后续实现）**
- 日语（ja / 日语）
- 韩语（ko / 韩语）
- 法语（fr / 法语）
- 德语（de / 德语）
- 西班牙语（es / 西班牙语）

#### 1.3 功能实现

**方案 A：使用本地翻译库（推荐，无API依赖）**

使用 `@vitalets/google-translate-api` 或类似库：
- 优点：无需API密钥，免费，快速响应
- 缺点：可能有使用限制，需要网络连接

**方案 B：使用在线API（备选）**

可选API：
- Google Translate API（需要API密钥）
- 百度翻译API（需要API密钥）
- 有道翻译API（需要API密钥）
- DeepL API（需要API密钥，质量较高）

**语言检测**
- 自动检测输入文本的语言（使用 `franc` 或 `language-detector` 库）
- 如果指定了源语言，使用指定的源语言
- 如果指定了目标语言，翻译到目标语言
- 如果都未指定，默认中英文互译

**输出格式**
```
原始文本 → 翻译结果
[中文] hello → [英文] 你好
```

#### 1.4 示例输入

```
translate hello
hello 翻译
翻译 hello
en 你好
zh hello world
translate hello to 中文
hello to 中文
你好 to English
翻译 你好 到 English
```

#### 1.5 错误处理

- 如果无法检测语言，提示用户指定语言
- 如果翻译失败，显示错误信息
- 如果网络不可用（使用API方案），提示离线模式

### 2. 变量名生成功能

#### 2.1 触发模式

**基础生成（默认驼峰命名）**
- `varname <描述文本>` 或 `变量名 <描述文本>`
- `<描述文本> varname` 或 `<描述文本> 变量名`

**指定命名风格**
- `varname <描述文本> camel` - 驼峰命名（camelCase）
- `varname <描述文本> snake` - 蛇形命名（snake_case）
- `varname <描述文本> pascal` - 帕斯卡命名（PascalCase）
- `varname <描述文本> constant` - 常量命名（CONSTANT_CASE）
- `varname <描述文本> kebab` - 短横线命名（kebab-case）

**快捷方式**
- `camel <描述文本>` - 直接生成驼峰命名
- `snake <描述文本>` - 直接生成蛇形命名
- `pascal <描述文本>` - 直接生成帕斯卡命名

#### 2.2 功能实现

**文本处理流程**
1. 输入文本预处理：
   - 去除多余空格
   - 处理中英文混合文本
   - 识别关键词汇

2. 中文处理：
   - 使用拼音转换（可复用现有的 `pinyin.ts` 工具）
   - 将中文转换为拼音
   - 处理多音字（选择常用读音）

3. 英文处理：
   - 识别单词边界
   - 处理缩写（如 "API" -> "api"）
   - 处理连字符和空格

4. 命名风格转换：
   - **camelCase**: `userName`, `userId`, `orderList`
   - **snake_case**: `user_name`, `user_id`, `order_list`
   - **PascalCase**: `UserName`, `UserId`, `OrderList`
   - **CONSTANT_CASE**: `USER_NAME`, `USER_ID`, `ORDER_LIST`
   - **kebab-case**: `user-name`, `user-id`, `order-list`

5. 输出多个选项：
   - 可以输出多种命名风格的选项供用户选择
   - 或者根据上下文智能推荐最合适的命名风格

**输出格式**

**单风格输出：**
```
原始描述 → 变量名
用户名称 → userName
```

**多风格输出（推荐）：**
```
原始描述：用户名称
camelCase:  userName
snake_case: user_name
PascalCase: UserName
CONSTANT:   USER_NAME
kebab-case: user-name
```

#### 2.3 示例输入

```
varname 用户名称
用户名称 varname
varname 用户名称 camel
varname user name
varname 订单列表 snake
camel 用户ID
snake 订单详情
pascal 商品价格
```

#### 2.4 高级功能（可选）

**上下文感知**
- 识别变量类型（如 "用户列表" -> `users` 而不是 `userList`）
- 识别布尔值（如 "是否启用" -> `isEnabled`）
- 识别ID（如 "用户ID" -> `userId` 而不是 `userID`）

**批量生成**
- `varname 用户名称,订单ID,商品价格` - 生成多个变量名

**语言识别**
- 自动识别中英文
- 支持中英文混合输入

## 三、实现方案

### 方案 1：创建独立的服务文件（推荐）

**优点**：
- 代码组织清晰，功能独立
- 易于维护和扩展
- 符合现有架构模式

**文件结构**：
```
src/main/services/
  ├── translateService.ts    # 翻译服务
  └── variableNameService.ts # 变量名生成服务
```

**集成方式**：
在 `calculatorService.ts` 中按优先级调用：
1. 先检测翻译查询
2. 再检测变量名生成查询
3. 最后检测其他计算功能

### 方案 2：合并为工具服务（备选）

创建一个 `utilityService.ts` 统一管理多个工具功能。

### 技术选型

#### 翻译功能

**方案 A：使用 `@vitalets/google-translate-api`（推荐）**
```bash
npm install @vitalets/google-translate-api
```

- 优点：无需API密钥，免费使用
- 缺点：依赖Google翻译服务，可能有使用限制

**方案 B：使用 `node-nlp` 本地库（备选）**
```bash
npm install node-nlp
```

- 优点：完全离线，隐私保护
- 缺点：需要下载语言模型，翻译质量可能不如在线API

#### 变量名生成功能

**拼音转换**
- 复用现有的 `src/shared/utils/pinyin.ts`
- 或使用 `pinyin-pro` 库（更准确的多音字处理）

**文本处理**
- 使用正则表达式处理英文单词
- 使用中文分词库（可选，如 `nodejieba`）

## 四、接口设计

### 翻译服务接口

```typescript
// src/main/services/translateService.ts

export interface TranslateResult {
  input: string;
  output: string;
  success: boolean;
  error?: string;
  from?: string;  // 源语言
  to?: string;    // 目标语言
}

class TranslateService {
  /**
   * 处理翻译查询
   */
  public handleTranslateQuery(query: string): TranslateResult | null;

  /**
   * 翻译文本
   */
  private async translate(text: string, from?: string, to?: string): Promise<string>;

  /**
   * 检测语言
   */
  private detectLanguage(text: string): string;

  /**
   * 解析翻译查询
   */
  private parseTranslateQuery(query: string): {
    text: string;
    from?: string;
    to?: string;
  } | null;
}
```

### 变量名生成服务接口

```typescript
// src/main/services/variableNameService.ts

export interface VariableNameResult {
  input: string;
  output: string;
  success: boolean;
  error?: string;
  options?: {
    camelCase: string;
    snakeCase: string;
    pascalCase: string;
    constantCase: string;
    kebabCase: string;
  };
}

class VariableNameService {
  /**
   * 处理变量名生成查询
   */
  public handleVariableNameQuery(query: string): VariableNameResult | null;

  /**
   * 生成变量名
   */
  private generateVariableName(text: string, style: 'camel' | 'snake' | 'pascal' | 'constant' | 'kebab'): string;

  /**
   * 生成所有风格的变量名
   */
  private generateAllStyles(text: string): VariableNameResult['options'];

  /**
   * 中文转拼音
   */
  private chineseToPinyin(text: string): string;

  /**
   * 英文单词处理
   */
  private processEnglishWords(text: string): string[];
}
```

## 五、集成到现有系统

### 1. 修改 calculatorService.ts

在 `calculate` 方法中添加新的服务调用：

```typescript
// 在编码解码查询之后，字符串工具查询之前
const translateResult = translateService.handleTranslateQuery(expression);
if (translateResult && translateResult.success) {
  return {
    input: translateResult.input,
    output: translateResult.output,
    success: translateResult.success,
    error: translateResult.error,
  };
}

// 在字符串工具查询之后
const variableNameResult = variableNameService.handleVariableNameQuery(expression);
if (variableNameResult && variableNameResult.success) {
  return {
    input: variableNameResult.input,
    output: variableNameResult.output,
    success: variableNameResult.success,
    error: variableNameResult.error,
  };
}
```

### 2. 修改 MainLayout.tsx

在 `isCalculation` 检测中添加新关键词：

```typescript
const isCalculation = (
  // ... 现有检测 ...
  // 翻译关键词检测
  /^(?:translate|翻译|en|zh|cn)\s+/i.test(queryTrimmed) ||
  /\s+(?:translate|翻译|to|到)$/i.test(queryTrimmed) ||
  /(?:translate|翻译)\s+.+\s+(?:to|到)\s+/i.test(queryTrimmed) ||
  // 变量名生成关键词检测
  /^(?:varname|变量名|camel|snake|pascal)\s+/i.test(queryTrimmed) ||
  /\s+(?:varname|变量名)$/i.test(queryTrimmed)
);
```

### 3. 创建 IPC Handlers

```typescript
// src/main/handlers/translateHandlers.ts
export function registerTranslateHandlers() {
  ipcMain.handle('translate-translate', async (_event, query: string) => {
    return translateService.handleTranslateQuery(query);
  });
}

// src/main/handlers/variableNameHandlers.ts
export function registerVariableNameHandlers() {
  ipcMain.handle('varname-generate', async (_event, query: string) => {
    return variableNameService.handleVariableNameQuery(query);
  });
}
```

## 六、使用示例

### 翻译功能示例

```
输入: translate hello
输出: hello → 你好

输入: en 你好世界
输出: 你好世界 → Hello World

输入: zh how are you
输出: how are you → 你好吗

输入: translate hello to 中文
输出: hello → 你好

输入: 你好 to English
输出: 你好 → Hello
```

### 变量名生成示例

```
输入: varname 用户名称
输出: 
用户名称
camelCase:  userName
snake_case: user_name
PascalCase: UserName
CONSTANT:   USER_NAME
kebab-case: user-name

输入: camel 订单列表
输出: 订单列表 → orderList

输入: snake 用户ID
输出: 用户ID → user_id

输入: pascal 商品价格
输出: 商品价格 → ProductPrice
```

## 七、技术考虑

### 性能优化

1. **翻译功能**：
   - 缓存常用翻译结果（避免重复请求）
   - 使用防抖处理用户输入
   - 异步处理，不阻塞UI

2. **变量名生成**：
   - 本地处理，无需网络请求
   - 拼音转换结果可缓存

### 错误处理

1. **翻译失败**：
   - 网络错误：提示"网络连接失败，请检查网络"
   - API限制：提示"翻译服务暂时不可用"
   - 语言不支持：提示"不支持该语言翻译"

2. **变量名生成失败**：
   - 输入为空：提示"请输入描述文本"
   - 无法识别：提示"无法识别输入，请使用中英文描述"

### 隐私和安全

1. **翻译功能**：
   - 如果使用在线API，确保传输加密
   - 考虑提供离线模式选项
   - 不记录用户翻译内容（可选）

2. **变量名生成**：
   - 完全本地处理，无隐私风险
   - 不发送任何数据到外部服务

## 八、测试用例

### 翻译功能测试

```
测试用例 1: 基础翻译
输入: translate hello
预期: hello → 你好

测试用例 2: 中文翻译
输入: zh 你好
预期: 你好 → Hello

测试用例 3: 指定目标语言
输入: translate hello to 中文
预期: hello → 你好

测试用例 4: 长文本翻译
输入: translate how are you today
预期: how are you today → 你今天好吗

测试用例 5: 错误处理
输入: translate
预期: 错误提示"请输入要翻译的文本"
```

### 变量名生成测试

```
测试用例 1: 基础生成
输入: varname 用户名称
预期: 输出所有命名风格

测试用例 2: 指定风格
输入: camel 用户ID
预期: 用户ID → userId

测试用例 3: 英文输入
输入: varname user name
预期: user name → userName (camelCase)

测试用例 4: 混合输入
输入: varname 用户User名称
预期: 正确处理中英文混合

测试用例 5: 错误处理
输入: varname
预期: 错误提示"请输入描述文本"
```

## 九、后续扩展

### 翻译功能扩展

1. **更多语言支持**
   - 逐步添加日语、韩语、法语等
   - 支持语言列表显示

2. **翻译历史**
   - 记录常用翻译
   - 快速重复翻译

3. **批量翻译**
   - 支持多行文本翻译
   - 支持文件翻译

### 变量名生成扩展

1. **更多命名风格**
   - 匈牙利命名法（如 `strUserName`）
   - 下划线前缀（如 `_userName`）

2. **智能建议**
   - 根据上下文推荐命名风格
   - 识别常见模式（如列表、ID、状态等）

3. **代码生成**
   - 生成完整的变量声明
   - 支持多语言代码生成（JavaScript、Python、Java等）

