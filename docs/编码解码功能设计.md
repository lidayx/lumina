# 编码解码功能设计

## 一、功能概述

在现有时间服务的基础上，新增编码解码和加密功能，支持：
1. **URL 编码/解码** - 将字符串转换为 URL 编码格式，或反向解码
2. **HTML 编码/解码** - 将字符串转换为 HTML 实体编码，或反向解码
3. **MD5 加密** - 计算字符串的 MD5 哈希值
4. **Base64 编码/解码** - 将字符串转换为 Base64 编码，或反向解码

## 二、功能设计

### 1. URL 编码/解码

#### 触发模式
- `url encode <字符串>` 或 `url编码 <字符串>`
- `url decode <字符串>` 或 `url解码 <字符串>`
- `<字符串> url encode` 或 `<字符串> url编码`
- `<字符串> url decode` 或 `<字符串> url解码`

#### 功能实现
- **编码**：将字符串转换为 URL 编码格式（如 `空格` → `%20`）
- **解码**：将 URL 编码字符串还原为原始字符串

#### 示例输入
```
url encode hello world
hello world url编码
url decode hello%20world
hello%20world url解码
```

### 2. HTML 编码/解码

#### 触发模式
- `html encode <字符串>` 或 `html编码 <字符串>`
- `html decode <字符串>` 或 `html解码 <字符串>`
- `<字符串> html encode` 或 `<字符串> html编码`
- `<字符串> html decode` 或 `<字符串> html解码`

#### 功能实现
- **编码**：将特殊字符转换为 HTML 实体（如 `<` → `&lt;`，`&` → `&amp;`）
- **解码**：将 HTML 实体还原为原始字符

#### 示例输入
```
html encode <div>test</div>
<div>test</div> html编码
html decode &lt;div&gt;test&lt;/div&gt;
&lt;div&gt;test&lt;/div&gt; html解码
```

### 3. MD5 加密

#### 触发模式
- `md5 <字符串>`
- `<字符串> md5`

#### 功能实现
- 计算字符串的 MD5 哈希值（32位十六进制字符串）
- 输出：`<原始字符串> → <MD5值>`

#### 示例输入
```
md5 hello world
hello world md5
```

### 4. Base64 编码/解码

#### 触发模式
- `base64 encode <字符串>` 或 `base64编码 <字符串>`
- `base64 decode <字符串>` 或 `base64解码 <字符串>`
- `<字符串> base64 encode` 或 `<字符串> base64编码`
- `<字符串> base64 decode` 或 `<字符串> base64解码`

#### 功能实现
- **编码**：将字符串转换为 Base64 编码
- **解码**：将 Base64 编码还原为原始字符串

#### 示例输入
```
base64 encode hello world
hello world base64编码
base64 decode aGVsbG8gd29ybGQ=
aGVsbG8gd29ybGQ= base64解码
```

## 三、实现方案

### 方案 1：扩展计算器服务（推荐）

**优点**：
- 复用现有的计算器检测逻辑
- 统一的结果显示格式
- 代码组织简单

**实现方式**：
1. 在 `calculatorService.ts` 中添加编码解码检测
2. 创建 `encodeService.ts` 单独服务文件处理编码解码
3. 在计算器服务的 `calculate` 方法中，在时间查询之后、单位换算之前检测编码解码查询

### 方案 2：独立服务（不推荐）

创建独立的编码解码服务，但需要单独集成到搜索流程中。

## 四、推荐实现步骤

### 步骤 1：创建编码解码服务文件
创建 `src/main/services/encodeService.ts`，包含：
- URL 编码/解码
- HTML 编码/解码
- MD5 加密
- Base64 编码/解码

### 步骤 2：扩展计算器服务
在 `calculatorService.ts` 的 `calculate` 方法中：
1. 在时间查询检测之后
2. 在单位换算检测之前
3. 添加编码解码查询检测
4. 调用 `encodeService` 处理

### 步骤 3：更新检测逻辑
在 `MainLayout.tsx` 的 `isCalculation` 检测中，添加编码解码关键词的检测：
- `url encode`、`url decode`、`url编码`、`url解码`
- `html encode`、`html decode`、`html编码`、`html解码`
- `md5`
- `base64 encode`、`base64 decode`、`base64编码`、`base64解码`

### 步骤 4：结果显示
- 编码解码结果直接显示，不需要拆分成多个选项
- 格式：`<原始> → <编码/解码结果>`

## 五、技术实现细节

### 1. URL 编码/解码
```typescript
// 编码
encodeURIComponent(text)

// 解码
decodeURIComponent(text)
```

### 2. HTML 编码/解码
```typescript
// 编码（需要手动处理）
function htmlEncode(text: string): string {
  return text
    .replace(/&/g, '&amp;')
    .replace(/</g, '&lt;')
    .replace(/>/g, '&gt;')
    .replace(/"/g, '&quot;')
    .replace(/'/g, '&#39;');
}

// 解码
function htmlDecode(text: string): string {
  const div = document.createElement('div');
  div.innerHTML = text;
  return div.textContent || div.innerText || '';
}
```

### 3. MD5 加密
需要安装 `crypto` 模块（Node.js 内置）：
```typescript
import { createHash } from 'crypto';

function md5(text: string): string {
  return createHash('md5').update(text).digest('hex');
}
```

### 4. Base64 编码/解码
```typescript
// 编码
Buffer.from(text, 'utf-8').toString('base64')

// 解码
Buffer.from(text, 'base64').toString('utf-8')
```

## 六、文件结构

```
src/main/services/
├── calculatorService.ts    # 扩展：添加编码解码检测
└── encodeService.ts         # 新增：编码解码服务

src/renderer/components/
└── MainLayout.tsx           # 扩展：添加编码解码检测
```

## 七、使用示例

### URL 编码
```
输入：url encode hello world
输出：hello%20world
```

### URL 解码
```
输入：url decode hello%20world
输出：hello world
```

### HTML 编码
```
输入：html encode <div>test</div>
输出：&lt;div&gt;test&lt;/div&gt;
```

### MD5 加密
```
输入：md5 hello
输出：5d41402abc4b2a76b9719d911017c592
```

### Base64 编码
```
输入：base64 encode hello world
输出：aGVsbG8gd29ybGQ=
```

## 八、注意事项

1. **错误处理**：编码解码失败时返回错误信息
2. **特殊字符**：确保正确处理各种特殊字符和 Unicode 字符
3. **中文支持**：确保所有编码方式都支持中文
4. **安全性**：MD5 是单向加密，无法解密
5. **结果显示**：编码解码结果应该清晰显示原始值和结果值

---

**文档创建日期**：2024年
**功能状态**：设计阶段
**预计实现时间**：1-2天

